(function(){"use strict";function findByClass(className){var result;if(typeof document.getElementsByClassName!=="undefined"){result=document.getElementsByClassName(className);}else if(typeof document.querySelectorAll!=="undefined"){result=document.querySelectorAll("."+className);}else{result=[];}
return result;}
function forEach(collection,func){var i,n;for(i=0,n=collection.length;i<n;i+=1){func(collection[i]);}}
function on(target,event,listener){if(typeof target.addEventListener!=="undefined"){target.addEventListener(event,listener,false);}else if(typeof target.attachEvent!=="undefined"){target.attachEvent("on"+event,listener);}}
function preventDefault(event){if(typeof event.preventDefault!=="undefined"){event.preventDefault();}else{event.returnValue=false;}}
function togglexhfbForm(id){var element=document.getElementById(id),isOpen=(element.style.display==="block"),forms=document.getElementsByTagName("fieldset"),i,form;for(i=0;i<forms.length;i+=1){form=forms[i];if(form.className==="xhfbform"){form.style.display="none";}}
if(!isOpen){element.style.display="block";element.getElementsByTagName("input")[0].focus();}}
function basename(filename){return(/[^\/\\]+$/).exec(filename)[0];}
function fileExists(filename){var result=false;forEach(findByClass("xhfbfile"),function(element){if(element.firstChild.nodeValue===filename){result=true;}});return result;}
function checkUpload(form,message){var filename=basename(form.elements.fbupload.value);if(fileExists(filename)){return window.confirm(message);}
return true;}
function promptNewName(renameForm,message){var oldNameInput=renameForm.renameFile,newName=window.prompt(message,oldNameInput.value);if(newName){oldNameInput.value=newName;}
return!!newName;}
function onToggleCreateFolder(){togglexhfbForm('xhfbCreateDir');}
function onToggleUploadFile(){togglexhfbForm('xhfbUploadFile');}
function onDeleteFolder(event){var target=event.target||event.srcElement,path=target.getAttribute("data-path"),message=FILEBROWSER.confirm_delete.replace("%s",path);if(!window.confirm(message)){preventDefault(event);}}
function onRenameFile(event){var target=event.target||event.srcElement,path=target.getAttribute("data-path"),message=FILEBROWSER.prompt_rename.replace("%s",path);if(!promptNewName(target,message)){preventDefault(event);}}
function onDeleteFile(event){var target=event.target||event.srcElement,path=target.getAttribute("data-path"),message=FILEBROWSER.confirm_delete.replace("%s",path);if(!window.confirm(message)){preventDefault(event);}}
function onUploadFile(event){var target=event.target||event.srcElement;if(!checkUpload(target,FILEBROWSER.confirm_upload)){preventDefault(event);}}
function onFileChoose(event){var target=event.target||event.srcElement;window.setLink(target.getAttribute("data-file"),target.getAttribute("data-is-image"));}
on(window,"load",function(){forEach(findByClass("filebrowser_folder_toggle"),function(element){on(element,"click",onToggleCreateFolder);});forEach(findByClass("filebrowser_upload_toggle"),function(element){on(element,"click",onToggleUploadFile);});forEach(findByClass("filebrowser_delete_folder"),function(element){on(element,"submit",onDeleteFolder);});forEach(findByClass("filebrowser_upload"),function(element){on(element,"submit",onUploadFile);});forEach(findByClass("filebrowser_rename_file"),function(element){on(element,"submit",onRenameFile);});forEach(findByClass("filebrowser_delete_file"),function(element){on(element,"submit",onDeleteFile);});if(!document.getElementById("filebrowser_subfolders")){forEach(findByClass("xhfbfile"),function(element){on(element,"click",onFileChoose);});}});}());